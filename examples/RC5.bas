10 LET KEYLEN = 32
20 LET WORDLEN = 4
31 LET MAGICP = 3084996963
32 LET MAGICQ = 2654435769
40 DIM TEMPKEY(16)
50 DIM KEY(32)
51 DIM SUBKEY(26)
52 DIM MY2DTHING(26,26)
60 GOSUB 1600
70 FOR I = KEYLEN - 1 TO 1 STEP -1
80 LET TEMPKEY(INT(I/WORDLEN)+1) = (TEMPKEY(INT(I/WORDLEN)+1) << 8) + KEY(I+1)
90 NEXT I
100 LET SUBKEY(1) = MAGICP
110 FOR J = 2 TO 26
120 LET SUBKEY(J) = SUBKEY(J-1) + MAGICQ
130 NEXT J
131 PRINT "SUBKEY DONE"
140 LET I = 1
150 LET J = 1
160 LET A = 0
170 LET B = 0
180 FOR Z = 1 TO 26*3 STEP 1
190 LET SUBKEY(I) = ((SUBKEY(I) + A + B) << 3 ) | ((SUBKEY(I) + A + B) >> (32 -3))
200 LET A = SUBKEY(I)
202 LET TKAB = TEMPKEY(J) + A + B
210 LET TEMPKEY(J) =  (TKAB << ((A + B)%32) ) | (TKAB >> (32 -((A+B)%32)))
220 LET B = TEMPKEY(J)
230 LET I =(I + 1)%26   + 1
240 LET J  = (J + 1)%8  + 1
250 NEXT Z
260 GOTO 5080


1600 LET KEY(1) = 3
1700 LET KEY(2) = 2
1800 LET KEY(3) = 5
1900 LET KEY(4) = 6 
2000 LET KEY(5) = 0 
2100 LET KEY(6) = 2 
2200 LET KEY(7) = 4 
2300 LET KEY(8) = 8 
2400 LET KEY(9) = 9
2500 LET KEY(10) = 1
2600 LET KEY(11) = 5
2700 LET KEY(12) = 6
2800 LET KEY(13) = 3
2900 LET KEY(14) = 7
3000 LET KEY(15) = 4
3100 LET KEY(16) = 1
3200 LET KEY(17) = 4
3300 LET KEY(18) = 1
3400 LET KEY(19) = 2
3500 LET KEY(20) = 8
3600 LET KEY(21) = 3
3700 LET KEY(22) = 0 
3800 LET KEY(23) = 6
3900 LET KEY(24) = 8
4000 LET KEY(25) = 3
4010 LET KEY(26) = 4
4020 LET KEY(27) = 5
4030 LET KEY(28) = 5
4040 LET KEY(29) = 5
4050 LET KEY(30) = 5
4060 LET KEY(31) = 5
4070 LET KEY(32) = 5
4080 RETURN

5080 LET FIRSTHALF = 12
5090 LET SECONDHALF = 31
5100 LET A = FIRSTHALF + SUBKEY(1)
5200 LET B = SECONDHALF + SUBKEY(2)
5250 LET R = 12
5300 FOR I = 1 TO R
5310 LET XORAB = A^B
5320 LET ASHIFTL = XORAB << (B%32)
5330 LET ASHIFTR = XORAB >> (32-(B%32))
5340 LET AS = SUBKEY(I+I+1)
5400 LET A = ((ASHIFTL | ASHIFTR) + AS)
5410 LET BSHIFTL = XORAB << (A%32)
5420 LET BSHIFTR = XORAB >> (32-(A%32))
5430 LET BS = SUBKEY(I+I+2)
5500 LET B = ((BSHIFTL | BSHIFTR) + BS)
5600 NEXT I
5610 PRINT A, " ", B

6000 REM void RC5_DECRYPT(WORD *ct, WORD *pt) {
6010 REM      WORD i, B=ct[1], A=ct[0];
6020 REM      for(i = r; i > 0; i--) {
6030 REM               B = ROTR(B - S[2*i + 1], A) ^ A;
6040 REM               A = ROTR(A - S[2*i], B) ^ B;
6050 REM      }
6060 REM     pt[1] = B - S[1]; pt[0] = A - S[0];

6700 PRINT "DECRYPT"
6710 LET I = R
6720 FOR J = 1 TO R
6730 LET A = A
6740 LET B = B
6810 LET BS = SUBKEY(I+I+2)
6830 LET BSHIFTR = (B-BS) >> (A%32)
6840 LET BSHIFTL = (B-BS) << (32-(A%32))
6900 LET B = ((BSHIFTR | BSHIFTL ) ^ A)
6910 LET AS = SUBKEY(I+I+1)
6920 LET ASHIFTR = (A - AS) >> (B%32)
6930 LET ASHIFTL = (A - AS) << (32-(B%32))
7100 LET A = ((ASHIFTR| ASHIFTL) ^ B)
7102 LET I = I - 1
7110 NEXT J 
7120 LET SECONDHALF = B - SUBKEY(2)
7130 LET FIRSTHALF = A - SUBKEY(1)
7131 PRINT FIRSTHALF, " ", SECONDHALF

50000 END


